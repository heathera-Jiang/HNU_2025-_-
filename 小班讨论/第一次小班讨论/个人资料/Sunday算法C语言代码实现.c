#include <stdio.h>
#include <string.h>
#define ASCII_SIZE 256  // ASCII???????§³

// ???????¦²????????????
void sunday_preprocess(const char *pattern, int m, int shift[]) {
    // ??????????????????????????????+1??
    // ?????????????????????????????????????????¦Â?????????
    for(int i=0; i<ASCII_SIZE; i++)
        shift[i] = m + 1;
    
    // ????????§Õ???????????
    // ????????????????????????¦Ã???¦Ë????¦Â?????????????????????
    for(int j=0; j<m; j++) {
        // ????????¦Ã????¦Ë????¦Â?????
        shift[(unsigned char)pattern[j]] = m - j;
    }
}

// ????? 
int sunday_search(const char *text, const char *pattern) {
    int n = strlen(text);
    int m = strlen(pattern);
    int shift[ASCII_SIZE];
    sunday_preprocess(pattern, m, shift);   // ????????
    
    // ??????
    int i = 0;  // i?????????????¦Ë??
    while(i <= n - m) {
        int k = i;     // ????????????
        int j = 0;     // ?????????????????¦Ë??
        
        // ????????
        while(j < m && text[k] == pattern[j]) {
            k++;
            j++;
        }
        
        // ????????????????¦Ë??
        if(j == m) return i;
        
        // ????????????????

        if(i + m >= n) break;  
        // ??????????§µ???????????¦Â????¦Æ????????

        // ??????????????????????????????????
        unsigned char next_char = text[i + m];
    
        // ????????????
        i += shift[next_char];
    }
    return -1;  // ¦Ä???
}

/* ??????? */
int main() {
    const char *text = "ABABDABACDABABCABAB";
    const char *pattern = "ABABC";
    
    int pos = sunday_search(text, pattern);
    if(pos != -1) {
        printf("??????????¦Ë???%d\n", pos);
        printf("????????%.*s\n", strlen(pattern), text + pos);
    } else {
        printf("??????\n");
    }
    return 0;
}